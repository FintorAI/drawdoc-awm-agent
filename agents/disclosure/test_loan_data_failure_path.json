{
  "_metadata": {
    "description": "Failure Path Test Data for Disclosure Agent v2 - Intentional blocking conditions",
    "version": "2.0",
    "scope": "Test data designed to FAIL - triggers multiple blocking conditions",
    "date_created": "2025-12-04",
    "source": "master_field_data.csv field mappings",
    "test_type": "failure_path",
    "current_date": "2025-12-04",
    "expected_outcome": "BLOCKED - should not proceed past verification"
  },

  "loan_id": "failure-test-loan-001",

  "_comment_failures": "=== INTENTIONAL FAILURES ===",
  "intentional_failures": [
    "Missing borrower phone (FE0117) - HARD STOP (G1)",
    "Missing borrower email (1240) - HARD STOP (G1)",
    "LE due date passed - Should escalate to supervisor",
    "Closing date < 15 days - Violates 15-day rule (G8)",
    "ATR/QM flags RED - Blocking compliance issue",
    "FHA loan type - Non-MVP (not Conventional)",
    "Texas property - Excluded from MVP"
  ],

  "_comment_mvp_eligibility": "=== MVP ELIGIBILITY (WILL FAIL) ===",
  "mvp_eligibility": {
    "1172": {
      "field_name": "Loan Type",
      "value": "FHA",
      "rule": "MUST be 'Conventional' (FHA/VA/USDA excluded from MVP)",
      "category": "Loan",
      "csv_verified": true,
      "failure_reason": "FHA is not supported in MVP - only Conventional"
    },
    "14": {
      "field_name": "Subject Property State",
      "value": "TX",
      "rule": "MUST be 'CA' or 'NV' (Texas excluded from MVP)",
      "category": "Loan",
      "csv_verified": true,
      "failure_reason": "Texas has special rules and is excluded from MVP"
    },
    "19": {
      "field_name": "Loan Purpose",
      "value": "Purchase",
      "rule": "'Purchase' or 'Refinance' supported",
      "category": "Loan",
      "csv_verified": true
    }
  },

  "_comment_trid": "=== TRID COMPLIANCE FIELDS (WILL FAIL) ===",
  "trid_fields": {
    "745": {
      "field_name": "Application Date",
      "value": "2025-11-20",
      "rule": "Must be set; LE due within 3 business days",
      "category": "Database",
      "action": "READ",
      "csv_verified": true,
      "note": "14 days ago - LE due date has passed",
      "failure_reason": "Application date is too old, LE due date passed"
    },
    "LE1.X1": {
      "field_name": "Loan Estimate - LE Date Issued",
      "value": null,
      "expected_value": "2025-12-04",
      "rule": "SET BY PREPARATION AGENT to current date when preparing LE",
      "category": "Database",
      "action": "WRITE",
      "csv_verified": true
    },
    "3152": {
      "field_name": "TIL Intl Disclosure Provided Date",
      "value": "2025-11-25",
      "rule": "LE Due Date - Calculated: App Date + 3 business days (excludes Sundays, holidays)",
      "category": "Database",
      "action": "READ",
      "csv_verified": true,
      "note": "Due date was 9 days ago - PASSED",
      "failure_reason": "LE due date has passed - should escalate to supervisor"
    },
    "761": {
      "field_name": "Lock Date",
      "value": "2025-11-20",
      "rule": "If locked, Case 1 flow applies",
      "category": "Database",
      "action": "READ",
      "csv_verified": true
    },
    "762": {
      "field_name": "Lock Expiration Date",
      "value": "2025-12-20",
      "rule": "For locked loans",
      "category": "Loan",
      "action": "READ",
      "csv_verified": true
    },
    "2400": {
      "field_name": "Closing Loan Info Loan is Locked",
      "value": "Y",
      "rule": "'Y' = Locked, 'N' = Not Locked",
      "category": "Database",
      "action": "READ",
      "csv_verified": true
    },
    "748": {
      "field_name": "Closing Date",
      "value": "2025-12-10",
      "rule": "MUST be >= 15 days from Application Date (or Lock Date if locked)",
      "category": "Loan",
      "action": "READ",
      "csv_verified": true,
      "note": "Only 6 days from today - violates 15-day rule",
      "failure_reason": "Closing date is only 6 days away - violates 15-day rule (G8)"
    }
  },

  "_comment_borrower": "=== BORROWER INFO (MISSING HARD STOPS) ===",
  "borrower_fields": {
    "4000": {
      "field_name": "Borrower First Name",
      "value": "JOHN",
      "category": "Borrowers",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "4002": {
      "field_name": "Borrower Last Name",
      "value": "FAILURE",
      "category": "Borrowers",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "65": {
      "field_name": "Borr SSN",
      "value": "999-99-9999",
      "category": "Borrowers",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "1240": {
      "field_name": "Borr Email",
      "value": null,
      "category": "Database",
      "action": "READ",
      "required": true,
      "hard_stop": true,
      "rule": "HARD STOP if missing - required for eDisclosures (G1)",
      "csv_verified": true,
      "failure_reason": "EMAIL MISSING - HARD STOP (G1)"
    },
    "FE0117": {
      "field_name": "Borr Business Phone",
      "value": null,
      "category": "Borrowers",
      "action": "READ",
      "required": true,
      "hard_stop": true,
      "rule": "HARD STOP if missing (G1)",
      "csv_verified": true,
      "failure_reason": "PHONE MISSING - HARD STOP (G1)"
    },
    "1402": {
      "field_name": "Borr DOB",
      "value": "1985-01-01",
      "category": "Database",
      "action": "READ",
      "required": true,
      "csv_verified": true
    }
  },

  "_comment_property": "=== PROPERTY INFO (Texas - MVP Excluded) ===",
  "property_fields": {
    "11": {
      "field_name": "Subject Property Address",
      "value": "123 FAILURE ST",
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "12": {
      "field_name": "Subject Property City",
      "value": "Houston",
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "14": {
      "field_name": "Subject Property State",
      "value": "TX",
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true,
      "failure_reason": "Texas property - excluded from MVP due to special state rules"
    },
    "15": {
      "field_name": "Subject Property Zip",
      "value": "77001",
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "1041": {
      "field_name": "Subject Property Type",
      "value": "Detached",
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "1811": {
      "field_name": "Occupancy (P/S/I)",
      "value": "PrimaryResidence",
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true
    }
  },

  "_comment_loan_terms": "=== LOAN TERMS ===",
  "loan_fields": {
    "1109": {
      "field_name": "Loan Amount",
      "value": 500000.00,
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "3": {
      "field_name": "Note Rate",
      "value": 7.5,
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "4": {
      "field_name": "Loan Term",
      "value": 360,
      "unit": "months",
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "353": {
      "field_name": "LTV",
      "value": 95.0,
      "category": "Ratios",
      "action": "READ",
      "rule": "If > 80%, MI calculation required for Conventional",
      "required": true,
      "csv_verified": true
    },
    "976": {
      "field_name": "Combined LTV",
      "value": 95.0,
      "category": "Ratios",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "356": {
      "field_name": "Appraised Value",
      "value": 526315,
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "136": {
      "field_name": "Subject Property Purchase Price",
      "value": 526315.00,
      "category": "Loan",
      "action": "READ",
      "required": true,
      "note": "Required for Purchase loans",
      "csv_verified": true
    }
  },

  "_comment_regz_le": "=== REGZ-LE FIELDS (Updated by Preparation Agent) ===",
  "regz_le_fields": {
    "LE1.X1": {
      "field_name": "LE Date Issued",
      "value": null,
      "expected_value": "2025-12-04",
      "action": "WRITE",
      "rule": "Set to current date when preparing LE"
    },
    "1176": {
      "field_name": "Interest Days Per Year",
      "value": null,
      "action": "WRITE",
      "rule": "Per SOP",
      "note": "Not set - will need to be set by agent"
    },
    "3514": {
      "field_name": "0% Payment Option",
      "value": null,
      "action": "VERIFY_BLANK",
      "rule": "Must be blank per SOP"
    },
    "3515": {
      "field_name": "Use Simple Interest Accrual",
      "value": null,
      "action": "VERIFY_BLANK",
      "rule": "Must be blank per SOP"
    },
    "3516": {
      "field_name": "Biweekly/Interim Interest Days",
      "value": null,
      "action": "WRITE",
      "rule": "Per SOP",
      "note": "Not set - will need to be set by agent"
    },
    "672": {
      "field_name": "Late Charge Days",
      "value": null,
      "action": "WRITE",
      "rule": "Conventional = 15 days",
      "note": "Not set - but loan is FHA anyway"
    },
    "673": {
      "field_name": "Late Charge Percent",
      "value": null,
      "action": "WRITE",
      "rule": "Conventional = 5% (FHA/VA = 4%, NC = 4% all)",
      "note": "Not set - FHA should be 4%"
    },
    "3517": {
      "field_name": "Assumption Text",
      "value": null,
      "action": "WRITE",
      "rule": "Conventional = 'may not', FHA/VA = 'may, subject to conditions'",
      "note": "Not set - FHA should be 'may, subject to conditions'"
    },
    "1751": {
      "field_name": "Buydown Marked",
      "value": false,
      "action": "READ",
      "rule": "If marked, buydown fields must be updated"
    },
    "664": {
      "field_name": "Prepayment Indicator",
      "value": "Will not",
      "action": "READ",
      "rule": "If 'Will/May/May be', update prepay penalty fields"
    }
  },

  "_comment_ctc": "=== CASH TO CLOSE FIELDS ===",
  "ctc_fields": {
    "loan_purpose": {
      "field_id": "19",
      "value": "Purchase",
      "rule": "Determines which CTC settings to apply"
    },
    "purchase_settings": {
      "NEWHUD2.X55": {
        "field_name": "Use Actual Down Payment",
        "value": false,
        "action": "WRITE",
        "applies_to": "Purchase loans",
        "note": "Not set correctly"
      },
      "NEWHUD2.X56": {
        "field_name": "Closing Costs Financed",
        "value": false,
        "action": "WRITE",
        "applies_to": "Purchase loans",
        "note": "Not set correctly"
      },
      "NEWHUD2.X57": {
        "field_name": "Include Payoffs in Adjustments",
        "value": false,
        "action": "WRITE",
        "applies_to": "Purchase loans",
        "note": "Not set correctly"
      }
    },
    "refinance_settings": {
      "NEWHUD2.X58": {
        "field_name": "Alternative Form Checkbox",
        "value": false,
        "action": "WRITE",
        "applies_to": "Refinance loans",
        "note": "Not applicable for this Purchase loan"
      }
    },
    "LE1.X77": {
      "field_name": "Displayed CTC (LE Page 2)",
      "value": 25000.00,
      "action": "READ",
      "rule": "Must match calculated CTC",
      "note": "May not match calculated - potential mismatch"
    }
  },

  "_comment_atr_qm": "=== ATR/QM FIELDS (FAILING - RED FLAGS) ===",
  "atr_qm_fields": {
    "ATRQM.X1": {
      "field_name": "Loan Features Flag",
      "value": "Does Not Meet",
      "expected_color": "Red",
      "action": "READ",
      "rule": "MUST BE GREEN - Blocking if Red",
      "required": true,
      "happy_path_value": "Green",
      "failure_reason": "RED FLAG - Loan features do not meet ATR/QM standards - BLOCKING"
    },
    "ATRQM.X2": {
      "field_name": "Points and Fees Flag",
      "value": "Does Not Meet",
      "expected_color": "Red",
      "action": "READ",
      "rule": "MUST BE GREEN - Blocking if Red",
      "required": true,
      "happy_path_value": "Green",
      "failure_reason": "RED FLAG - Points and fees exceed limits - BLOCKING"
    },
    "ATRQM.X3": {
      "field_name": "Price Limit Flag",
      "value": "Does Not Meet",
      "expected_color": "Red",
      "action": "READ",
      "rule": "MUST BE GREEN - Blocking if Red",
      "required": true,
      "happy_path_value": "Green",
      "failure_reason": "RED FLAG - Price limit exceeded - BLOCKING"
    }
  },

  "_comment_mavent": "=== MAVENT COMPLIANCE (FAILING) ===",
  "mavent": {
    "check_via_api": "GET /ecs/v1/compliancereports",
    "expected_result": {
      "fails": 5,
      "alerts": 3,
      "warnings": 2
    },
    "rule": "MUST have no Fails/Alerts/Warnings - Blocking if any exist",
    "acceptable_exceptions": ["26.4"],
    "note": "Has multiple Fails/Alerts/Warnings - BLOCKING",
    "failure_reason": "Mavent compliance has blocking issues"
  },

  "_comment_edisclosures": "=== eDISCLOSURES API ===",
  "edisclosures_api": {
    "loan_id": "failure-test-loan-001",
    "application_id": {
      "source": "GET /encompass/v3/loans/{loanId} -> applications[0].id",
      "expected_format": "UUID",
      "example": "failure-app-id-001",
      "current_value_in_test_loan": null,
      "note": "May not be available for failure test"
    },
    "borrower_info": {
      "full_name": "JOHN FAILURE",
      "email": null,
      "phone": null,
      "note": "Missing phone and email - HARD STOPS"
    },
    "api_flow": [
      "Step 1: POST /encompassdocs/v1/documentAudits/opening (audit loan)",
      "Step 2: POST /encompassdocs/v1/documentOrders/opening (create doc set)",
      "Step 3: POST /encompassdocs/v1/documentOrders/opening/{docSetId}/delivery (send to borrower)"
    ],
    "note": "Will not reach this step due to blocking conditions"
  },

  "_comment_lo_info": "=== LOAN ORIGINATOR INFO ===",
  "lo_info": {
    "317": {
      "field_name": "Loan Officer",
      "value": "Test LO",
      "category": "Loan",
      "action": "READ",
      "required": true,
      "csv_verified": true
    },
    "3238": {
      "field_name": "NMLS Loan Originator ID",
      "value": "999999",
      "category": "Database",
      "action": "READ",
      "rule": "Must verify LO is licensed in property state (CA)",
      "required": true,
      "csv_verified": true,
      "note": "May not be licensed in TX"
    },
    "3330": {
      "field_name": "Income Year 2 Total Variance Joint Income Borr and Co-Borrower",
      "value": "999999",
      "category": "Database",
      "action": "READ",
      "note": "This field ID from CSV may not be Company NMLS - verify mapping",
      "csv_verified": true
    }
  },

  "_comment_status": "=== STATUS FIELDS ===",
  "status_fields": {
    "2626": {
      "field_name": "Loan Info Channel",
      "value": "Retail",
      "category": "Database",
      "action": "READ",
      "rule": "Must be set",
      "csv_verified": true
    },
    "1393": {
      "field_name": "Loan Status",
      "value": "Active",
      "category": "Loan",
      "action": "READ",
      "rule": "Must be Active for processing",
      "csv_verified": true
    }
  },

  "_comment_summary": "=== FAILURE PATH SUMMARY ===",
  "failure_path_summary": {
    "expected_blocking_conditions": [
      {
        "condition": "Missing phone (FE0117)",
        "severity": "CRITICAL",
        "type": "HARD STOP (G1)",
        "should_block": true
      },
      {
        "condition": "Missing email (1240)",
        "severity": "CRITICAL",
        "type": "HARD STOP (G1)",
        "should_block": true
      },
      {
        "condition": "LE due date passed",
        "severity": "CRITICAL",
        "type": "TRID violation",
        "should_block": true,
        "action": "Escalate to Supervisor"
      },
      {
        "condition": "Closing date < 15 days",
        "severity": "CRITICAL",
        "type": "15-day rule violation (G8)",
        "should_block": true
      },
      {
        "condition": "Non-Conventional loan (FHA)",
        "severity": "HIGH",
        "type": "MVP exclusion",
        "should_block": true
      },
      {
        "condition": "Texas property",
        "severity": "HIGH",
        "type": "MVP exclusion",
        "should_block": true
      },
      {
        "condition": "ATR/QM flags RED",
        "severity": "CRITICAL",
        "type": "Compliance failure",
        "should_block": true
      },
      {
        "condition": "Mavent has Fails/Alerts/Warnings",
        "severity": "CRITICAL",
        "type": "Compliance failure",
        "should_block": true
      }
    ],
    "expected_agent_behavior": {
      "pre_check": "Should pass (loan is Active)",
      "verification": "Should FAIL with multiple blocking issues",
      "preparation": "Should NOT reach this step",
      "send": "Should NOT reach this step",
      "overall_status": "BLOCKED - manual processing required"
    }
  },

  "_comment_test_validation": "=== TEST VALIDATION ===",
  "test_validation": {
    "purpose": "Verify disclosure agent correctly identifies and blocks loans with critical issues",
    "success_criteria": [
      "Agent detects all 8 blocking conditions",
      "Agent stops at verification stage",
      "Agent returns comprehensive error list",
      "Agent does not attempt to write any fields",
      "Agent does not call eDisclosures API"
    ],
    "failure_count": 8,
    "expected_execution_time": "< 30 seconds (should fail fast)"
  }
}

